---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Header from "../../components/Header.astro";
import LoadingScreen from "../../components/LoadingScreen.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";

const posts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<!DOCTYPE html>
<html lang="ko">
	<head>
		<BaseHead
			title={`Blog | ${SITE_TITLE}`}
			description={SITE_DESCRIPTION}
		/>
		<style>
			main {
				width: 860px;
			}
			.page-title {
				text-align: center;
				font-family: "DotGothic16", monospace;
				font-size: 2em;
				color: var(--text-primary);
				margin-bottom: 0.5em;
			}
			.page-subtitle {
				text-align: center;
				font-family: "DotGothic16", monospace;
				font-size: 0.9em;
				color: var(--text-muted);
				margin-bottom: 2em;
			}
			.post-count-badge {
				display: inline-block;
				padding: 0.25em 0.8em;
				background: var(--bg-window-body);
				border: 2px solid var(--border-window);
				font-family: "DotGothic16", monospace;
				font-size: 0.8em;
				color: var(--accent-dark);
			}

			/* Browser-frame post list */
			.posts-browser {
				border: 3px solid var(--border-window);
				box-shadow: var(--box-shadow-window);
				background: var(--bg-content);
			}
			.browser-titlebar {
				background: var(--accent-light);
				padding: 4px 10px;
				display: flex;
				align-items: center;
				justify-content: flex-end;
				min-height: 24px;
				border-bottom: 2px solid var(--border-window);
			}
			.browser-btn {
				width: 18px;
				height: 18px;
				border: 2px solid var(--border-window);
				background: var(--bg-window-body);
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 9px;
				color: var(--accent-dark);
				margin-left: 3px;
			}
			.browser-toolbar {
				background: var(--bg-window-body);
				padding: 6px 10px;
				display: flex;
				align-items: center;
				gap: 6px;
				border-bottom: 2px solid var(--border-window);
			}
			.browser-nav-btn {
				font-family: "DotGothic16", monospace;
				font-size: 14px;
				color: var(--accent-dark);
			}
			.browser-url {
				flex: 1;
				background: var(--bg-content);
				border: 2px solid var(--border-window);
				padding: 3px 8px;
				font-family: "DotGothic16", monospace;
				font-size: 11px;
				color: var(--text-muted);
				display: flex;
				align-items: center;
				gap: 4px;
			}
			.browser-body {
				padding: 0;
			}

			/* Post list */
			ul {
				list-style: none;
				margin: 0;
				padding: 0;
			}
			ul li {
				width: 100%;
				margin: 0;
			}
			.post-item {
				display: flex;
				gap: 1em;
				align-items: center;
				padding: 1em 1.25em;
				text-decoration: none;
				color: inherit;
				border-bottom: 1px dashed var(--border-color);
				transition: all var(--transition-fast);
			}
			.post-item:hover {
				background: rgba(255, 209, 220, 0.35);
				text-decoration: none;
			}
			.post-item:last-child {
				border-bottom: none;
			}
			.folder-icon {
				width: 44px;
				height: auto;
				image-rendering: pixelated;
				flex-shrink: 0;
			}
			.post-info {
				flex: 1;
				min-width: 0;
			}
			.post-info .date {
				font-size: 0.8em;
				color: var(--text-muted);
				margin-bottom: 0.25em;
				font-family: "DotGothic16", monospace;
			}
			.post-info .title {
				font-size: 1.05em;
				font-family: "DotGothic16", monospace;
				font-weight: 400;
				color: var(--text-primary);
				margin: 0 0 0.25em;
				line-height: 1.3;
				transition: color var(--transition-fast);
			}
			.post-item:hover .title {
				color: var(--accent-dark);
			}
			.post-info .description {
				font-size: 0.85em;
				color: var(--text-secondary);
				margin: 0;
				line-height: 1.5;
				display: -webkit-box;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
				overflow: hidden;
			}

			@media (max-width: 768px) {
				.page-title {
					font-size: 1.6em;
				}
				.post-item {
					padding: 0.75em 1em;
				}
				.folder-icon {
					width: 32px;
				}
			}
		</style>
	</head>
	<body>
		<LoadingScreen />
		<Header />
		<main>
			<h1 class="page-title">üìÇ Blog Posts</h1>
			<p class="page-subtitle">
				<span class="post-count-badge">üìù {posts.length} posts</span>
			</p>

			<div class="posts-browser">
				<div class="browser-titlebar">
					<div style="display:flex;gap:3px;">
						<span class="browser-btn">_</span>
						<span class="browser-btn">‚ñ°</span>
						<span class="browser-btn">‚úï</span>
					</div>
				</div>
				<div class="browser-toolbar">
					<span class="browser-nav-btn">‚Üê</span>
					<span class="browser-nav-btn">‚Üí</span>
					<span>üè†</span>
					<div class="browser-url">
						<span>üåê</span>
						suttolog.netlify.app/blog
					</div>
					<span>‚≠ê</span>
					<span>‚ò∞</span>
				</div>
				<div class="browser-body">
					<ul>
						{
							posts.map((post) => (
								<li>
									<a
										href={`/blog/${post.id}/`}
										class="post-item"
									>
										<img
											src="/folder_icon.png"
											alt=""
											class="folder-icon"
										/>
										<div class="post-info">
											<p class="date">
												<FormattedDate
													date={post.data.pubDate}
												/>
											</p>
											<h3 class="title">
												{post.data.title}
											</h3>
											<p class="description">
												{post.data.description}
											</p>
										</div>
									</a>
								</li>
							))
						}
					</ul>
				</div>
			</div>
		</main>
		<Footer />
	</body>
</html>
